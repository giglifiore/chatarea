<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Chat por Zona</title>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>

  </head>
  <body>
    <h2>Chat Público por Zona</h2>

    <div id="chat-box" style="border:1px solid #ccc; height:300px; overflow:auto; padding:10px;"></div>

    <input type="text" id="message" placeholder="Escribe un mensaje..." />
    <button id="send">Enviar</button>

    <script>
      // Tu configuración de Firebase
       const firebaseConfig = {
      apiKey: "AIzaSyAsKJn2Z5Jb5iW4H8OjUBIXmZWXekGXCyU",
      authDomain: "chatarea-6170e.firebaseapp.com",
      projectId: "chatarea-6170e",
      storageBucket: "chatarea-6170e.firebasestorage.app",
      messagingSenderId: "147913199399",
      appId: "1:147913199399:web:886f09ab74017b3fc22302",
      measurementId: "G-RECZQ87BG4",
      databaseURL: "https://chatarea-6170e-default-rtdb.firebaseio.com" // ✅ importante
    };

      // Inicializar Firebase
      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.database();
      const auth = firebase.auth();

      // Login anónimo
      auth.signInAnonymously().catch(error => {
        console.error("Error al autenticar:", error);
      });

      const chatBox = document.getElementById("chat-box");
      const input = document.getElementById("message");
      const sendBtn = document.getElementById("send");

      // Enviar mensaje
      sendBtn.addEventListener("click", () => {
        const text = input.value.trim();
        if (text === "") return;

        const msg = {
          text,
          timestamp: Date.now(),
          uid: auth.currentUser ? auth.currentUser.uid : "anon"
        };

        firebase.database().ref("mensajes").push(msg);
        input.value = "";
      });

      // Escuchar nuevos mensajes (solo se agrega una vez)
      const mensajesRef = firebase.database().ref("mensajes");
      mensajesRef.off(); // Evita duplicados si recargas el script

      mensajesRef.on("child_added", snapshot => {
        const msg = snapshot.val();
        const div = document.createElement("div");
        div.textContent = msg.text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    </script>
  </body>
</html>
